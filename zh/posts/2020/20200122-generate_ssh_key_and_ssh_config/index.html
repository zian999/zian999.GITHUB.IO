<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Github SSH key和SSH config的使用 | Nature and Human</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />

    

        
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body);
        });
    </script>

    
    <link rel="stylesheet" href="/css/highlightjs/styles/github.css">
    <script src="/css/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <header>
      <nav>
        <ul>
          
          
          <li class="nav-menu">
              <a href="https://zian999.github.io/zh">/home/zh</a>
          </li>
          
          
          <li class="nav-menu">
            <a href="/zh/tags/">~/zh/Tags</a>
          </li>
          
          
          <li class="nav-menu">
            <a href="/en">~/EN</a>
          </li>
          

          
          
          <li class="nav-feed">
            <a href="/zh/index.xml">[rss]</a>
          </li>
          

        </ul>
      </nav>
    </header>
  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title">Github SSH key和SSH config的使用</span></h1>

<h2 class="date">2020/01/22</h2>
<p class="terms">
  
  
  Tags: <a href="/tags/ssh">SSH</a> <a href="/tags/github">github</a> 
  
  
</p>
</div>


<br/><nav id="TableOfContents">
  <ul>
    <li><a href="#生成sshkey">生成sshkey</a>
      <ul>
        <li><a href="#我的补充">我的补充</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#配置项说明">配置项说明</a>
      <ul>
        <li><a href="#我的补充-1">我的补充</a></li>
      </ul>
    </li>
  </ul>
</nav><br/>


<main>
<p>在MacBook上每次git push都要输入Github的用户名和密码十分麻烦。可以使用SSH来做到免输密码，而且学会了之后还可以用SSH登录其他网站。（好像也可以通过将Github密码缓存在Git中做到免输密码，具体可以看这个<a href="https://help.github.com/en/github/using-git/caching-your-github-password-in-git">帮助文档</a>）</p>
<p>主要参考的网页有<a href="https://deepzz.com/post/github-generate-ssh-key.html">Deepzz的文章1</a>和<a href="https://deepzz.com/post/how-to-setup-ssh-config.html">Deepzz的文章2</a>，关于在macOS上将passphrases存在Keychain里的方法，参考<a href="https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">Github的这个帮助文档</a>。</p>
<p>下面，我从上面三个网页把有用的内容粘贴过来备忘。</p>
<hr>
<h1 id="github-ssh-key生成免密登录服务器方法">Github ssh key生成，免密登录服务器方法</h1>
<p>作者：Deepzz</p>
<p>链接：https://deepzz.com/post/github-generate-ssh-key.html</p>
<h2 id="生成sshkey">生成sshkey</h2>
<p>1、查看是否存在ssh key，如果有会列出key的列表</p>
<pre><code>$ ls -al ~/.ssh
# Lists the files in your .ssh directory, if they exist
</code></pre><p>2、没有，继续创建，下一步</p>
<pre><code>$ ssh-keygen -t ecdsa -b 256 -C &quot;your_email@example.com&quot;
Generating public/private ecdsa key pair.
</code></pre><p>3、使用默认配置，点击Enter，继续</p>
<pre><code>Enter file in which to save the key (/Users/you/.ssh/id_ecdsa): [Press enter]
</code></pre><p>4、输入密码，可以为空，Enter。(如果有密码，以后每次使用到该key都会要求输入密码)</p>
<pre><code>Enter passphrase (empty for no passphrase): [Type a passphrase]
Enter same passphrase again: [Type passphrase again]
</code></pre><p>5、到这里，ssh key 创建完成</p>
<pre><code>Your identification has been saved in /Users/you/.ssh/id_ecdsa.
Your public key has been saved in /Users/you/.ssh/id_ecdsa.pub.
The key fingerprint is:
SHA256:VSGP++8s1yT9lpTRc12O+6+pxoqa5qeIB/D85nKnMjE your_email@example.com
The key's randomart image is:
+---[ECDSA 256]---+
|          . o.   |
|           =    .|
|          o .  o+|
|  .      . .  .o=|
|   +    S .    o=|
|    E .   o.  +o.|
|     B . o +. .*.|
|    o.*.o . =o.o=|
|    ooooBo ..=*oo|
+----[SHA256]-----+
</code></pre><p>6、添加到ssh-agent。首先确定ssh-agent is enabled:</p>
<pre><code># start the ssh-agent in the background
$ eval &quot;$(ssh-agent -s)&quot;
Agent pid 59566
</code></pre><p>7、添加</p>
<pre><code>$ ssh-add ~/.ssh/id_ecdsa
</code></pre><p>8、说明 id_ecdsa是私钥，id_ecdsa.pub是公钥。私钥是不能外泄的，我们需要用到的是公钥。 读取到公钥的内容，你就可以在github添加key了。</p>
<h3 id="我的补充">我的补充</h3>
<p>在上面的第四步中，一般还是推荐要设置passphrase。这样虽然在之后的使用中每次连接都会要求输入passphrase，但是安全更有保障，不用太担心万一私钥丢失被别人随意使用。如果使用的是macOS，可以通过配置SSH的config文件将passphrase存储到自己的Keychain里。具体方法见后面一篇文章的我的补充。</p>
<h1 id="ssh-config-那些你所知道和不知道的事">SSH Config 那些你所知道和不知道的事</h1>
<p>作者：Deepzz</p>
<p>链接：https://deepzz.com/post/how-to-setup-ssh-config.html</p>
<p>SSH（Secure Shell）是什么？是一项创建在应用层和传输层基础上的安全协议，为计算机上的 Shell（壳层）提供安全的传输和使用环境。也是专为远程登录会话和其他网络服务提供安全性的协议。它能够有效防止远程管理过程中的信息泄露问题。通过 SSH 可以对所有传输的数据进行加密，也能够防止 DNS 欺骗和 IP 欺骗。</p>
<p>具体生成SSH Key方式请参考：<a href="https://deepzz.com/post/github-generate-ssh-key.html">Github ssh key生成，免密登录服务器方法</a>。这里以<code>id_ecdsa</code>（私钥） 和<code>id_ecdsa.pub</code>（公钥） 为例。</p>
<p>本篇文章主要介绍 SSH 相关的使用技巧。通过对<code>~/.ssh/config</code>文件的配置你可以大大简化 SSH 相关的操作，如：</p>
<pre><code>Host example                       # 关键词
    HostName example.com           # 主机地址
    User root                      # 用户名
    # IdentityFile ~/.ssh/id_ecdsa # 认证文件
    # Port 22                      # 指定端口
</code></pre><p>通过执行<code>$ ssh example</code>我就可以登录我的服务器。而不需要敲更多的命令<code>$ ssh root@example.com</code>。又如我们想要向服务器传文件<code>$ scp a.txt example:/home/user_name</code>。比以前方便多了。</p>
<p>更过相关帮助文档请参考<code>$ man ssh_config 5</code>。</p>
<h2 id="配置项说明">配置项说明</h2>
<p>SSH 的配置文件有两个：</p>
<pre><code>$ ~/.ssh/config            # 用户配置文件
$ /etc/ssh/ssh_config      # 系统配置文件
</code></pre><p>下面来看看常用的配置参数。</p>
<p><strong>Host</strong></p>
<p>用于我们执行 SSH 命令的时候如何匹配到该配置。</p>
<pre><code>`*`，匹配所有主机名。
`*.example.com`，匹配以 .example.com 结尾。
`!*.dialup.example.com,*.example.com`，以 ! 开头是排除的意思。
`192.168.0.?`，匹配 192.168.0.[0-9] 的 IP。
</code></pre>
<p><strong>AddKeysToAgent</strong></p>
<p>是否自动将 key 加入到 <code>ssh-agent</code>，值可以为 no(default)/confirm/ask/yes。</p>
<p>如果是 yes，key 和密码都将读取文件并以加入到 agent ，就像 ssh-add。其他分别是询问、确认、不加入的意思。添加到 ssh-agent 意味着将私钥和密码交给它管理，让它来进行身份认证。</p>
<p><strong>AddressFamily</strong></p>
<p>指定连接的时候使用的地址族，值可以为 any(default)/inet(IPv4)/inet6(IPv6)。</p>
<p><strong>BindAddress</strong></p>
<p>指定连接的时候使用的本地主机地址，只在系统有多个地址的时候有用。在 UsePrivilegedPort 值为 yes 的时候无效。</p>
<p><strong>ChallengeResponseAuthentication</strong></p>
<p>是否响应支持的身份验证 chanllenge，yes(default)/no。</p>
<p><strong>Compression</strong></p>
<p>是否压缩，值可以为 no(default)/yes。</p>
<p><strong>CompressionLevel</strong></p>
<p>压缩等级，值可以为 1(fast)-9(slow)。6(default)，相当于 gzip。</p>
<p><strong>ConnectionAttempts</strong></p>
<p>退出前尝试连接的次数，值必须为整数，1(default)。</p>
<p><strong>ConnectTimeout</strong></p>
<p>连接 SSH 服务器超时时间，单位 s，默认系统 TCP 超时时间。</p>
<p><strong>ControlMaster</strong></p>
<p>是否开启单一网络共享多个 session，值可以为 no(default)/yes/ask/auto。需要和 ControlPath 配合使用，当值为 yes 时，ssh 会监听该路径下的 control socket，多个 session 会去连接该 socket，它们会尽可能的复用该网络连接而不是重新建立新的。</p>
<p><strong>ControlPath</strong></p>
<p>指定 control socket 的路径，值可以直接指定也可以用一下参数代替：</p>
<pre><code>%L 本地主机名的第一个组件
%l 本地主机名（包括域名）
%h 远程主机名（命令行输入）
%n 远程原始主机名
%p 远程主机端口
%r 远程登录用户名
%u 本地 ssh 正在使用的用户名
%i 本地 ssh 正在使用 uid
%C 值为 %l%h%p%r 的 hash
</code></pre>
<p>请最大限度的保持 ControlPath 的唯一。至少包含 %h，%p，%r（或者 %C）。</p>
<p><strong>ControlPersist</strong></p>
<p>结合 ControlMaster 使用，指定连接打开后后台保持的时间。值可以为 no/yes/整数，单位 s。如果为 no，最初的客户端关闭就关闭。如果 yes/0，无限期的，直到杀死或通过其它机制，如：ssh -O exit。</p>
<p><strong>GatewayPorts</strong></p>
<p>指定是否允许远程主机连接到本地转发端口，值可以为 no(default)/yes。默认情况，ssh 为本地回环地址绑定了端口转发器。</p>
<p><strong>HostName</strong></p>
<p>真实的主机名，默认值为命令行输入的值（允许 IP）。你也可以使用 %h，它将自动替换，只要替换后的地址是完整的就 ok。</p>
<p><strong>IdentitiesOnly</strong></p>
<p>指定 ssh 只能使用配置文件指定的 identity 和 certificate 文件或通过 ssh 命令行通过身份验证，即使 ssh-agent 或 PKCS11Provider 提供了多个 identities。值可以为 no(default)/yes。</p>
<p><strong>IdentityFile</strong></p>
<p>指定读取的认证文件路径，允许 DSA，ECDSA，Ed25519 或 RSA。值可以直接指定也可以用一下参数代替：</p>
<pre><code>%d，本地用户目录 ~
%u，本地用户
%l，本地主机名
%h，远程主机名
%r，远程用户名
</code></pre>
<p><strong>LocalCommand</strong></p>
<p>指定在连接成功后，本地主机执行的命令（单纯的本地命令）。可使用 %d，%h，%l，%n，%p，%r，%u，%C 替换部分参数。只在 PermitLocalCommand 开启的情况下有效。</p>
<p><strong>LocalForward</strong></p>
<p>指定本地主机的端口通过 ssh 转发到指定远程主机。格式：LocalForward [bind_address:]post host:hostport，支持 IPv6。</p>
<p><strong>PasswordAuthentication</strong></p>
<p>是否使用密码进行身份验证，yes(default)/no。</p>
<p><strong>PermitLocalCommand</strong></p>
<p>是否允许指定 LocalCommand，值可以为 no(default)/yes。</p>
<p><strong>Port</strong></p>
<p>指定连接远程主机的哪个端口，22(default)。</p>
<p><strong>ProxyCommand</strong></p>
<p>指定连接的服务器需要执行的命令。%h，%p，%r</p>
<p>如：ProxyCommand /usr/bin/nc -X connect -x 192.0.2.0:8080 %h %p</p>
<p><strong>User</strong></p>
<p>登录用户名</p>
<h3 id="我的补充-1">我的补充</h3>
<p>如前面所说，macOS用户可以不用每次都输入passphrase。只需在<code>~/.ssh/config</code>文件中的<code>Host *</code>项下面加入<code>UseKeychain yes</code>，即可将passphrase存入自己的苹果Keychain里。</p>

</main>

<br/><hr/>
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'tchkm6';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    <footer>
      
<script>
(function() {
  function center_el(tagName) {
    var tags = document.getElementsByTagName(tagName), i, tag;
    for (i = 0; i < tags.length; i++) {
      tag = tags[i];
      var parent = tag.parentElement;
      
      if (parent.childNodes.length === 1) {
        
        if (parent.nodeName === 'A') {
          parent = parent.parentElement;
          if (parent.childNodes.length != 1) continue;
        }
        if (parent.nodeName === 'P') parent.style.textAlign = 'center';
      }
    }
  }
  var tagNames = ['img', 'embed', 'object'];
  for (var i = 0; i < tagNames.length; i++) {
    center_el(tagNames[i]);
  }
})();
</script>

      
      <hr/>
      <a href="/zh/about/">About</a> | <a href="http://img.gg/59aLicM">Nikon Image Space</a> | <a href="https://www.flickr.com/photos/48159639@N04/">Flickr</a>
      
    </footer>
  </body>
</html>

